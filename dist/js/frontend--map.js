var myMap,suggestView,placemark,subwaylist,highwaylist,centermap,zoom,iconCaption,balloonContent;function init(){null==centermap&&(centermap=[45.054381,38.98035],zoom=10),(myMap=new ymaps.Map("map",{center:centermap,zoom})).controls.remove("geolocationControl"),myMap.controls.remove("searchControl"),myMap.controls.remove("trafficControl"),(suggestView=new ymaps.SuggestView("suggest")).events.add("select",(function(e){geocode()}))}function geocode(){var e=$("#suggest").val();ymaps.geocode(e).then((function(e){showResult(e.geoObjects.get(0))}),(function(e){console.log(e)}))}function showResult(e){let t=$("#map"),a=e.properties.get("boundedBy");addOnMapBalloon(ymaps.util.bounds.getCenterAndZoom(a,[t.width(),t.height()]),[e.getThoroughfare(),e.getPremiseNumber(),e.getPremise()].join(" "))}function addOnMapBalloon(e,t){let a=$("#objname").val(),o=a.length>0?a:t,n=a.length>0?a+"<br>"+t:t;$("#coords").val(e.center),myMap.setCenter(e.center,e.zoom),myMap.geoObjects.remove(placemark),placemark=new ymaps.Placemark(e.center,{iconCaption:o,balloonContent:n},{preset:"islands#redDotIconWithCaption",draggable:!0}),myMap.geoObjects.add(placemark),placemark.events.add("dragend",(function(e){let t=e.get("target").geometry.getCoordinates();$("#coords").val(t),ymaps.geocode(t).then((function(e){var t=e.geoObjects.get(0).properties.getAll();$("#suggest").val(t.text)}))}))}function setsuggestion(e,t){$("#"+e).val().length<1&&new ymaps.SuggestView(e,{provider:t,results:3}).events.add("select",(function(t){console.log("select"),$("#"+e).parent().next().find("input[type=text]").focus()}))}ymaps.ready(init),$((function(){let e=!0;$("#object_adding").on("submit",(function(t){if(t.preventDefault(),!e)return;e=!1,setTimeout((()=>{e=!0}),1e3);const a=document.getElementById("object_adding").querySelector(".-obj-edit-submit-");a.classList.remove("btn--primary"),a.classList.add("btn--gray");const o=a.textContent,n=document.createElement("div");n.classList.add("loader"),n.classList.add("loader--prev"),a.setAttribute("disable",!0),a.textContent="Сохраняем",a.insertAdjacentElement("afterbegin",n);var i=$(this),s=new FormData(i.get(0));[...i.get(0).querySelectorAll('input[type="file"]')].map((e=>{e.detail&&(s.delete(e.getAttribute("name")),e.detail.files.map((t=>{s.append(e.getAttribute("name"),t,t.name)})))}));const r=parseInt($("#object_adding").find("input[name=ID]").val()),l=$("#object_adding").find("input[name=IS_ARCHIVE]").val();var c="/manager/";$.ajax({type:"POST",url:"/local/ajax/obj_add_edit_save.php",contentType:!1,processData:!1,enctype:"multipart/form-data",data:s,success:function(e){if("ok"==e.status)if($.fancybox.close(),e.update?Modal.open("success-obj-modal-update"):Modal.open("success-obj-modal"),a.innerHTML=o,r>0)"Y"==l&&(c="/manager/archive/objects.php"),$.ajax({type:"GET",url:c+"?id="+r+"&reloadobj=Y",dataType:"html",success:function(e){$('.object-element[data-id="'+r+'"]').replaceWith(e),jQuery.fancybox.modalInit(),document.querySelector(".jk-item-gallery-slider")&&new Swiper(".jk-item-gallery-slider",{watchSlidesProgress:!0,watchSlidesVisibility:!0,loop:!1,spaceBetween:10,slidesPerView:1,slidesPerGroup:1,slideClass:"swiper-slide",touchRatio:1,navigation:{prevEl:".jk-item-gallery-arrow-prev",nextEl:".jk-item-gallery-arrow-next"},pagination:{el:".jk-item-gallery-pagination",type:"fraction"},breakpoints:{992:{}}})}});else{let e=$("#objlist_bxajaxid").val();BX.ajax.insertToNode("/manager/?bxajaxid="+e,"comp_"+e),setTimeout((function(){jQuery.fancybox.modalInit(),document.querySelector(".jk-item-gallery-slider")&&new Swiper(".jk-item-gallery-slider",{watchSlidesProgress:!0,watchSlidesVisibility:!0,loop:!1,spaceBetween:10,slidesPerView:1,slidesPerGroup:1,slideClass:"swiper-slide",touchRatio:1,navigation:{prevEl:".jk-item-gallery-arrow-prev",nextEl:".jk-item-gallery-arrow-next"},pagination:{el:".jk-item-gallery-pagination",type:"fraction"},breakpoints:{992:{}}})}),4e3)}},dataType:"json"})}))})),function(){const e=[],t=document.getElementById("PHOTO_SECOND_REMOVELIST");document.addEventListener("click",(a=>{if(!a.target.closest("[data-secondremid]"))return;a.stopPropagation(),a.preventDefault();const o=a.target.closest("[data-secondremid]").getAttribute("data-secondremid");e.push(o),t.value=e.join(",");const n=a.target.closest(".form-field-file");n.parentElement.removeChild(n)}))}();